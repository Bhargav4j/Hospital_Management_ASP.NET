@page
@model HospitalManagement.Web.Pages.Patient.AppointmentsModel
@{
    ViewData["Title"] = "My Appointments";
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-12">
            <h2>
                <i class="bi bi-calendar-check"></i> My Appointments
            </h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-page="/Patient/Home">Dashboard</a></li>
                    <li class="breadcrumb-item active">My Appointments</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <div class="btn-group" role="group">
                        <a asp-page="/Patient/Appointments" asp-route-filter="all" class="btn @(Model.Filter == "all" ? "btn-primary" : "btn-outline-primary")">
                            All (@Model.AllCount)
                        </a>
                        <a asp-page="/Patient/Appointments" asp-route-filter="upcoming" class="btn @(Model.Filter == "upcoming" ? "btn-primary" : "btn-outline-primary")">
                            Upcoming (@Model.UpcomingCount)
                        </a>
                        <a asp-page="/Patient/Appointments" asp-route-filter="pending" class="btn @(Model.Filter == "pending" ? "btn-warning" : "btn-outline-warning")">
                            Pending (@Model.PendingCount)
                        </a>
                        <a asp-page="/Patient/Appointments" asp-route-filter="completed" class="btn @(Model.Filter == "completed" ? "btn-success" : "btn-outline-success")">
                            Completed (@Model.CompletedCount)
                        </a>
                    </div>
                    <div class="float-end">
                        <a asp-page="/Patient/ViewDoctors" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Book New Appointment
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (Model.Appointments != null && Model.Appointments.Any())
    {
        <div class="row">
            @foreach (var appointment in Model.Appointments)
            {
                <div class="col-md-6 mb-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header @GetHeaderClass(appointment.Status)">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="bi bi-calendar-event"></i> Appointment #@appointment.AppointmentID
                                </h5>
                                <span class="badge @GetBadgeClass(appointment.Status)">
                                    @appointment.Status
                                </span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <h6 class="text-primary">
                                    <i class="bi bi-person-badge"></i> Dr. @appointment.DoctorName
                                </h6>
                            </div>

                            <p class="mb-2">
                                <i class="bi bi-calendar"></i> <strong>Date:</strong>
                                @appointment.AppointmentDate.ToString("MMMM dd, yyyy")
                            </p>

                            @if (!string.IsNullOrEmpty(appointment.Disease))
                            {
                                <p class="mb-2">
                                    <i class="bi bi-clipboard-pulse"></i> <strong>Reason:</strong>
                                    @appointment.Disease
                                </p>
                            }

                            @if (!string.IsNullOrEmpty(appointment.Prescription))
                            {
                                <div class="alert alert-info mb-2">
                                    <strong><i class="bi bi-prescription2"></i> Prescription:</strong>
                                    <p class="mb-0">@appointment.Prescription</p>
                                </div>
                            }

                            @if (!string.IsNullOrEmpty(appointment.Progress))
                            {
                                <p class="mb-2">
                                    <i class="bi bi-graph-up"></i> <strong>Progress:</strong>
                                    @appointment.Progress
                                </p>
                            }

                            <div class="mt-3">
                                <p class="mb-1">
                                    <i class="bi bi-receipt"></i> <strong>Payment Status:</strong>
                                    @if (appointment.IsPaid)
                                    {
                                        <span class="badge bg-success">Paid</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">Unpaid</span>
                                    }
                                </p>
                            </div>
                        </div>
                        <div class="card-footer">
                            <small class="text-muted">
                                Created on @appointment.CreatedDate.ToString("MMM dd, yyyy")
                            </small>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="row mt-3">
            <div class="col-md-12">
                <p class="text-muted">Showing @Model.Appointments.Count() appointment(s)</p>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> No appointments found.
            <a asp-page="/Patient/ViewDoctors" class="alert-link">Book your first appointment</a>
        </div>
    }
</div>

@functions {
    private string GetHeaderClass(string status)
    {
        return status switch
        {
            "Pending" => "bg-warning text-dark",
            "Completed" => "bg-success text-white",
            "Cancelled" => "bg-danger text-white",
            "Confirmed" => "bg-info text-white",
            _ => "bg-secondary text-white"
        };
    }

    private string GetBadgeClass(string status)
    {
        return status switch
        {
            "Pending" => "bg-dark",
            "Completed" => "bg-light text-dark",
            "Cancelled" => "bg-light text-dark",
            "Confirmed" => "bg-light text-dark",
            _ => "bg-light text-dark"
        };
    }
}
